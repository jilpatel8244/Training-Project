<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>all posts</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <style>
    </style>
</head>

<body>
    <div class="container paggination text-center" style="padding-top: 50px;">
        <button class="btn btn-outline-dark" onclick="prevHandler()">&#8592;</button>
        <span id="currPage" style="padding: 0 15px;"></span>
        <button class="btn btn-outline-dark" onclick="nextHandler()">&#8594;</button>
    </div>
    <div class=" container d-flex p-4" style="width: 20%;">
        <input class="form-control" type="text" placeholder="Search Title" aria-label="Search" id="search_text">
        <button class="btn btn-outline-success my-2 my-sm-0" type="submit" onclick="searchHandler()">Search</button>
    </div>
    <div class="container">
        <table class="table">
            <thead>
                <tr>
                    <th>id</th>
                    <th>user id</th>
                    <th>title</th>
                    <th>more details</th>
                </tr>
            </thead>
            <tbody id="table_body">

            </tbody>
        </table>
        <p id="not_found"></p>
    </div>

    <script>
        let posts;
        let posts1;
        let currentPage = 1;
        let no_of_records_per_page = 10;
        let total_no_of_pages;



        const fetchAllPosts = async () => {
            try {
                const data = await fetch("https://jsonplaceholder.typicode.com/posts");
                posts = await data.json();

                if(data.status == 404) {
                    let table_body = document.getElementById("table_body");
                    table_body.innerHTML = 'data not found';
                } else {
                    // all fetched posts are stored in posts1 because when filter applies in order to search then original posts are saved
                    posts1 = posts;
    
                    displayData();
                }

            } catch (error) {
                console.error(error);
            }
        }
        fetchAllPosts();

        const displayData = () => {
            try {
                total_no_of_pages = Math.ceil(posts.length / no_of_records_per_page);

                let table_body = document.getElementById("table_body");

                let currPage = document.getElementById("currPage");
                currPage.innerHTML = currentPage;

                let start;
                let end;

                if (posts.length == 0) {
                    document.getElementById("not_found").innerHTML = "data not found";
                }
                else if (posts.length < no_of_records_per_page) {
                    start = (currentPage - 1) * no_of_records_per_page;
                    end = posts.length;
                } else {
                    start = (currentPage - 1) * no_of_records_per_page;
                    end = currentPage * no_of_records_per_page;
                }

                let slicedPosts = posts.slice(start, end);

                table_body.innerHTML = "";

                slicedPosts.forEach(post => {
                    let tr = document.createElement("tr");
                    let td_more_details = document.createElement("td");
                    let td_title = document.createElement("td");
                    let td_userId = document.createElement("td");
                    let td_id = document.createElement("td");

                    td_more_details.innerHTML = `<a href="/app/v1/getSinglePostDetails?id=${post.id}">more info.</a>`;
                    td_title.innerHTML = post.title;
                    td_userId.innerHTML = post.userId;
                    td_id.innerHTML = post.id;

                    tr.appendChild(td_id);
                    tr.appendChild(td_userId);
                    tr.appendChild(td_title);
                    tr.appendChild(td_more_details);

                    table_body.appendChild(tr);
                });
            } catch (error) {
                console.error(error);
            }
        }

        function nextHandler() {
            if (currentPage < total_no_of_pages) {
                currentPage = currentPage + 1;
            }
            displayData();
        }

        function prevHandler() {
            if (currentPage > 1) {
                currentPage = currentPage - 1;
            }
            displayData();
        }

        function searchHandler() {
            document.getElementById("not_found").innerHTML = "";
            currentPage = 1
            let search_text = document.getElementById("search_text").value;
            console.log(search_text);

            posts = posts1.filter((post) => {
                if (JSON.stringify(post.title).includes(search_text)) {
                    return post;
                }
            })
            displayData();
        }
    </script>
</body>

</html>